!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function a(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function s(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=n(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,d=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){d=!0,o=t},f:function(){try{i||null==a.return||a.return()}finally{if(d)throw o}}}}const o=(t,...e)=>{let a=(t,e)=>(e.forEach(((e,a)=>{t=t.replace("%"+(a+1)+"$",e)})),t);return void 0===window.i18n||void 0===window.i18n.state.locale.values[t]?a(t,e):a(window.i18n.state.locale.values[t],e)},i=(t,...e)=>{if(0===(t=String(t)).length)return"";return((t,e,...a)=>{let n=(t,e)=>(e.forEach(((e,a)=>{t=t.replace("%"+(a+1)+"$",e)})),t);return void 0===window.i18n||void 0===window.i18n.state.locale.values[t]?n(t,a):n(e(window.i18n.state.locale.values[t]),a)})(t,(t=>t.replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[t])))),...e)},d=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},c=t=>{let e=new URLSearchParams(window.location.search),a=e.get("sid")?e.get("sid"):"",n=-1==t.indexOf("?")?"?sid="+a:"&sid="+a;return t+n},l=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},u=t=>{let e=t+"=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let n=a[t];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},p=()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+l()+"/"+u("locale");return e!=u("check")&&(t=0,console.log("refresh")),((t,e,a)=>{let n="";if(a){let t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),n=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+n+";path=/;domain=.kenzap.cloud"})("check",e,5),t},m=()=>({Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+u("kenzap_api_key"),"Kenzap-Locale":u("locale")?u("locale"):"en","Kenzap-Header":p(),"Kenzap-Token":u("kenzap_token"),"Kenzap-Sid":l()}),v={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+u("kenzap_api_key"),"Kenzap-Locale":u("locale")?u("locale"):"en","Kenzap-Header":p(),"Kenzap-Token":u("kenzap_token"),"Kenzap-Sid":l()},h=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",l()),a.append("token",u("kenzap_token")),a.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+encodeURIComponent(window.location.href)}else alert(t.reason)},f=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("click",e,!0),a.addEventListener("click",e,!0)},y=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("keyup",e,!0),a.addEventListener("keyup",e,!0)},g=t=>{let e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)},b=t=>{if(!document.querySelector(".toast")){let t='\n        <div class="toast-cont position-fixed bottom-0 p-2 m-4 end-0 align-items-center" style="z-index:10000;">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",t)}let e=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=t,e.show()};var _=function(t){return(""+t).length<2?"0"+t:t},w=function(t,e){switch(e=S(e),e=(Math.round(100*parseFloat(e))/100).toFixed(2),t.state.settings.currency_symb_loc){case"left":e=t.state.settings.currency_symb+" "+e;break;case"right":e+=t.state.settings.currency_symb}return e},S=function(t){return t=t||0,t=parseFloat(t),t=Math.round(100*t)/100},x=function(t,e){document.querySelector(t)&&(e.push.apply(e,[9,37,38,39,40,98,100,102,104]),a(document.querySelectorAll(t)).forEach((function(t){t.addEventListener("keydown",(function(t){var a=t.key.toLowerCase();"control"!=a&&"meta"!=a||(window[a]=!0),console.log(a.length+" / "+n+" / "+t.which);var n=a>="0"&&a<="9";return(window.control||window.meta)&&[86,88,65,67,90].includes(t.which)?(console.log("pushing"),!0):n||e.includes(t.which)?void 0:(t.preventDefault(),!1)})),t.addEventListener("keyup",(function(t){var e=t.key.toLowerCase();"control"!=e&&"meta"!=e||(window[e]=!1)}))})))},q=function(t,e,a){var n=(e=parseInt(e))-(a=parseInt(a));if(n<60)return t("moments ago");if(n<3600)return parseInt(n/60)+" "+t("minutes ago");if(n<86400)return parseInt(n/60/60)+" "+t("hours ago");var r=new Date(1e3*a),s=[t("Jan"),t("Feb"),t("Mar"),t("Apr"),t("May"),t("Jun"),t("Jul"),t("Aug"),t("Sep"),t("Oct"),t("Nov"),t("Dec")],o=r.getFullYear(),i=s[r.getMonth()],d=r.getDate();return r.getHours(),r.getMinutes(),r.getSeconds(),a=d+" "+i+" "+o},k=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},L=function(t){return t=(t=(t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&#39;/g,"'")).replace(/&amp;/g,"&")},T=function(t,e){t.state.playSound.n=0,t.state.playSound.timer&&clearInterval(t.state.playSound.timer),t.state.playSound.allowed&&t.state.playSound.audio.play();try{t.state.playSound.allowed&&((a=navigator.userAgent.toLowerCase()).match(/iphone/i)||a.match(/ipod/i)||a.match(/ipad/i)||a.match(/android/i))&&window.navigator.vibrate(200)}catch(t){}var a;1!=e&&(t.state.playSound.timer=setInterval((function(){t.state.playSound.allowed&&(t.state.playSound.audio.play(),t.state.playSound.n>e&&clearInterval(t.state.playSound.timer),t.state.playSound.n+=1)}),5e3))},M=function(t,e){var a="",n=!1;if(e.forEach((function(e){t.state.playSound.nids.includes(e._id)||(t.state.playSound.nids.push(e._id),n=!0),document.querySelector('#contents .container [data-id="'+e._id+'"]')||(a+='\n\n            <div class="alert alert-'.concat(e.color,' alert-dismissible fade show" role="alert" data-id="').concat(e._id,'">\n                <div class="d-flex align-items-center">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-square flex-shrink-0 me-2" viewBox="0 0 16 16">\n                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n                        <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>\n                    </svg>\n                    <div>\n                    ').concat(e.msg,'\n                    </div>\n                </div>\n                <button type="button" class="btn-close btn-dismiss-notify" data-bs-dismiss="alert" aria-label="Close" data-id="').concat(e._id,'"></button>\n            </div>'))})),n&&(T(t,1),t.getData()),document.querySelector("#contents .container")&&document.querySelector("#contents .container").insertAdjacentHTML("afterbegin",a),function(t,e){if(document.querySelector(t)){var a,n=s(document.querySelectorAll(t));try{for(n.s();!(a=n.n()).done;){var r=a.value;r.removeEventListener("click",e,!0),r.addEventListener("click",e,!0)}}catch(t){n.e(t)}finally{n.f()}}}(".btn-dismiss-notify",(function(t){fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:m(),body:JSON.stringify({query:{updates:{type:"dismiss",id:t.currentTarget.dataset.id}}})}).then((function(t){return t.json()})).then((function(t){t.success})).catch((function(t){}))})),document.querySelector(".order-details")){var r,o=s(document.querySelectorAll(".order-details"));try{for(o.s();!(r=o.n()).done;){var i=r.value;if("1"==i.dataset.assigned)return;i.dataset.assigned=1,i.addEventListener("click",(function(t){var e=document.querySelector(".view-order[data-id='"+t.currentTarget.dataset.id+"']");g(e)}),!0)}}catch(t){o.e(t)}finally{o.f()}}},C=function(t){var e=i("Pages 1.0.5 by %1$Kenzap%2$. ❤️ Licensed %3$GPLv3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/pages" target="_blank">',"</a>"),a=i("%1$Developer mode%2$",'<a class="text-muted" href="'.concat(c("/develop/"),'" target="_self">'),"</a>");document.querySelector("footer .row").innerHTML='\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">'.concat(e,'</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">').concat(a,"</span>\n    </div>")},O=function(t,e){var n,r=t.split("\n"),o="",i=s(r);try{var d=function(){var t=n.value,r=e,s=t.indexOf("[S]"),i=t.indexOf("[R]"),d=t.indexOf("[L]"),c=t.indexOf("[C]");if(r-=E(t)?E(t):1,-1!=s&&(t=t.substr(0,s)+t.substr(s+3,t.length)),-1!=i){var l=r-(t.substr(0,i)+t.substr(i+3,t.length)).length;-1!=d&&(l+=3),-1!=c&&(l+=3),t=t.substr(0,i)+z(l)+t.substr(i+3,t.length)}if(-1!=d){var u=r-(t.substr(0,d)+t.substr(d+3,t.length)).length;t=t.substr(0,d)+t.substr(d+3,t.length)+z(u)}if(-1!=c){var p=r-(t.substr(0,i)+t.substr(i+3,t.length)).length;t=z(Math.floor(p/2))+t.substr(0,c)+t.substr(c+3,t.length)+z(Math.ceil(p/2))}var m=0;if(a(t).forEach((function(t){" "==t&&(m+=1)})),m>=r&&(t=""),t.length>e){for(var v="",h=0,f=0;f<t.length;f++)h+=1,v+=t[f],f%e==0&&f>0&&(v+="\n",h=0);for(var y=h;y<e;y++)v+=" ";console.log(v),t=v}o+=t+"\n"};for(i.s();!(n=i.n()).done;)d()}catch(t){i.e(t)}finally{i.f()}return o},z=function(t){for(var e="",a=0;a<=t;a++)e+=" ";return e},H=function(t,e,a,n){n-=1;for(var r="",s=0,o=!0,i=0;i<t.length;i++)r+=t[i],s+=1+E(t[i]),o&&s>=n-(e+a)&&(r+="\n[L]",s=0,o=!1),s>=n-a&&(r+="\n[L]",s=0);return r},E=function(t){for(var e=/[\u3400-\u4db5\u4e00-\u9fa5\uf900-\ufa2d]/,a=0,n=!1,r=t.length,s=0;s<r;s++){var o=t.charAt(s);e.test(o)&&(a+=n?2:1,n=!1)}return a},I=function(t,e,a,n){var r="";for(var s in e.items)if(null==e.items[s].cats&&(e.items[s].cats=[]),e.items[s].cats.includes(a)||!(a.length>0)){var i=w(t,e.items[s].total);for(var d in r+="[L]".concat(e.items[s].qty," X ").concat(H(o(e.items[s].title),(e.items[s].qty+"").length+3,(i+"").length,n),"[R]").concat(i,"\n"),e.items[s].variations){for(var c in r+="[L] ".concat(H(o(e.items[s].variations[d].title),1,0,n),":"),e.items[s].variations[d].list)r+=" ".concat(o(e.items[s].variations[d].list[c].title),",");r.endsWith(",")&&(r=r.substring(0,r.length-1)+"\n"),r.endsWith("\n")||(r+="\n")}}return r.endsWith("\n")&&(r=r.substring(0,r.length-1)),r},A=function(t){t.state.lastPrintTime||(t.state.lastPrintTime=Math.floor(Date.now()/1e3)),setInterval((function(t){if(Math.floor(Date.now()/1e3)-t.state.lastPrintTime>7&&t.state.printQueue.length>0){var e=t.state.printQueue.shift();!function(t,e,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s={},d={},c=new Date;if("test"==e?s={_id:"test",id:"test",created:1649831099,from:"dine-in",idd:"",items:[{cats:[],id:"02de5fc62938ba0b031b4e80e962bac15a7285d8",index:"0",note:"",price:45,qty:2,sdesc:"Salted Egg Crab",title:"咸蛋螃蟹",total:45,type:"new",variations:[]},{cats:[],id:"69ae96cfb7b25c358dd07560fc55e7d83cae2eb7",index:"0",note:"",price:45,qty:1,sdesc:"Kam Heong Crab",title:"金香螃蟹",total:45,type:"new",variations:[]},{cats:["Other"],id:"a678f2b21a3a3f7e97b6707d8223f32d17ecbefa",index:"0",note:"",price:10,qty:12,sdesc:"",title:"鱼鳔羮",total:10,type:"new",variations:[]},{cats:["Other"],id:"a678f2b21a3a3f7e97b6707d8223f32d17ecbefa",index:"0",note:"",price:25,qty:1,sdesc:"",title:"螃蟹米粉汤 (粗/幼米粉）",total:25,type:"new",variations:[]},{cats:["Other"],id:"a678f2b21a3a3f7e97b6707d8223f32d17ecbefa",index:"0",note:"",price:4,qty:1,sdesc:"",title:"Fied Chicken Noodles",total:4,type:"new",variations:[]}],kid:"0",name:"dine-in",note:"",sid:l,status:"new",price:{discount_percent:10,discount_total:11.105,discount_value:0,fee_total:0,grand_total:99.95,payment_method:"Cash",tax_percent:0,tax_total:0,total:111.05},step:1,table:"table test",total:111.05,total_all:99.95,updated:1649833845}:(s=t.state.orders.filter((function(t){return t._id==e}))[0],d={},c=new Date),console.log(s),d.debug=r,n)d.print=n.template;else{var u=t.state.settings.templates.filter((function(e){return"receipt"==e.type&&e.user==t.state.user.id}));0==u.length&&(u=t.state.settings.templates.filter((function(t){return"receipt"==t.type&&""==t.user}))),d.print=u.length>0?u[0].template:"Kenzap Cloud: no receipt template found",n=u.length>0?u[0]:{}}var p=d.print.indexOf("[W:"),m=20;-1!=p&&(m=parseInt(d.print.substr(p+3,2)),d.print=d.print.substr(0,p)+d.print.substr(p+6,d.print.length)),d.print=d.print.replace(/{{order_id}}/g,s.id?s.id:"-"),d.print=d.print.replace(/{{order_from}}/g,s.from),d.print=d.print.replace(/{{order_takeaway}}/g,s.takeaway?"dine-in"==s.takeaway?i("dine-in"):i("take away"):i("dine-in")),d.print=d.print.replace(/{{order_note}}/g,s.note?s.note:""),d.print=d.print.replace(/{{order_phone}}/g,s.phone?s.phone:""),d.print=d.print.replace(/{{order_addr1}}/g,s.addr1?s.addr1:""),d.print=d.print.replace(/{{order_table}}/g,s.table?i("Table #%1$",s.table):""),d.print=d.print.replace(/{{date_time}}/g,c.toLocaleString([],{dateStyle:"medium",timeStyle:"short"})),d.print=d.print.replace(/{{order_items}}/g,I(t,s,"",m));var f=d.print.matchAll(/{{order_items:(.*?):start}}/g);Array.from(f,(function(t){return t[1]})).forEach((function(e){var a=I(t,s,e,m),n="{{order_items:"+e+"}}",r=new RegExp(n,"g");if(d.print=d.print.replace(r,a),a.length<2){var o=d.print.indexOf("{{order_items:"+e+":start}}"),i=d.print.indexOf("{{order_items:"+e+":end}}")+("{{order_items:"+e+":end}}").length;d.print=d.print.slice(0,o)+d.print.slice(i)}else n="\n{{order_items:"+e+":start}}",r=new RegExp(n,"g"),d.print=d.print.replace(r,""),n="\n{{order_items:"+e+":end}}",r=new RegExp(n,"g"),d.print=d.print.replace(r,"")})),d.print=d.print.replace(/{{total}}/g,w(t,s.price.total)),d.print=d.print.replace(/{{tax_total}}/g,w(t,s.price.tax_total)),d.print=d.print.replace(/{{discount_total}}/g,w(t,s.price.discount_total)),d.print=d.print.replace(/{{grand_total}}/g,w(t,s.price.grand_total));var y="";y+="[L]"+o("Subtotal")+"[R]"+w(t,s.price.total)+"\n",s.price.discount_total>0&&(y+="[L]"+o("Discount")+"[R]-"+w(t,s.price.discount_total)+"\n"),s.price.fee_total>0&&(y+="[L]"+t.state.settings.fee_display+"[R]"+w(t,s.price.fee_total)+"\n"),s.price.tax_total>0&&(y+="[L]"+t.state.settings.tax_display+"[R]"+w(t,s.price.tax_total)+"\n"),s.price.grand_total>0&&(y+="[L]"+o("Grand Total")+"[R]"+w(t,s.price.grand_total)),d.print=d.print.replace(/{{order_totals}}/g,y),document.querySelector("#qr-number")&&(d.print=d.print.replace(/{{qr_number}}/g,document.querySelector("#qr-number").value));var g="user"==a?n.user_print:n.auto_print;d.user=t.state.user.id,d.printers=[],d.printers.push(g[0]),d.type="receipt",d.print=O(d.print,m),fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:v,body:JSON.stringify({query:{print:{type:"print",data:d,sid:l()}}})}).then((function(t){return t.json()})).then((function(e){e.success?b(o("Printing order #"+s.id)):D(t,e)})).catch((function(t){h(t)})),t.state.printRequest=null}(t,e._id,e.type,e.template),t.state.lastPrintTime=Math.floor(Date.now()/1e3)}}),50,t);var e=t.state.settings.templates.filter((function(e){return"new"==e.auto_print_action&&"receipt"==e.type&&(""==e.user||e.user==t.state.user.id)}));if(0==e.length)return!1;setInterval((function(t){var a=localStorage.hasOwnProperty("last_print_id")?localStorage.getItem("last_print_id"):0,n=t.state.orders.filter((function(e,n){return"new"==e.status&&parseInt(t.state.orders[n].id)>a}));n.reverse(),e.forEach((function(e,r){n.forEach((function(n,r){e.auto_print.forEach((function(a,r){var s={auto_print:[],auto_print_action:e.auto_print_action,template:e.template,type:e.type,user:e.user};s.auto_print.push(a),t.state.printQueue.push({id:n.id,_id:n._id,type:"auto",template:s})})),n.id>a&&(a=n.id)}))})),localStorage.setItem("last_print_id",a)}),5e3,t)},D=function(t,e){b(o(e.reason)),document.querySelector('.alert[data-id="print-api"')&&document.querySelector('.alert[data-id="print-api"').remove();var a=[{_id:"print-api",color:"danger",msg:i(e.reason)}];M(t,a);try{isMobile()&&window.navigator.vibrate(200)}catch(t){}},N={_this:null,firstLoad:!0,state:{orderSingle:null},render:function(t,e){if("1"==t.state.settings.tables){var a=t.state.settings.table_list.trim().split("\n"),n='<div id="table_list" class="row row-cols-1 row-cols-lg-5 row-cols-md-3 row-cols-sm-2 g-3 mb-3">';t.state.orders.forEach((function(t){t.table&&t.table.length>0&&(a.includes(t.table)||"0"==t.table||a.push(t.table)),!t.takeaway||"new"!=t.status&&"processing"!=t.status||a.includes(__("Take away")+" #"+t.id)||"dine-in"==t.takeaway||a.push(__("Take away")+" #"+t.id)})),a.forEach((function(e,a){n+=N.structTableCard(t,a,e,{orders:t.state.orders,meta:t.state.meta})})),n+="</div>",document.querySelector("#table_list")&&document.querySelector("#table_list").remove(),document.querySelector("#orders-after-header").insertAdjacentHTML("beforeend",n),N.firstLoad&&(N.firstLoad=!1,f(".print-qr",(function(e){e.preventDefault(),function(t,e){var a={debug:!1},n=t.state.settings.templates.filter((function(e){return"qr"==e.type&&(""==e.user||e.user==t.state.user.id)}));a.print=n.length>0?n[0].template:"Kenzap Cloud: no qr template found",a.print=a.print.replace(/{{qr_link}}/g,"http://"+t.state.qr_settings.slug+".kenzap.site"),e=e||document.querySelector("#qr-number").value,a.print=a.print.replace(/{{qr_number}}/g,e);var r=a.print.indexOf("[W:"),s=20;-1!=r&&(s=parseInt(a.print.substr(r+3,2)),a.print=a.print.substr(0,r)+a.print.substr(r+6,a.print.length)),a.print=O(a.print,s),console.log(a.print);var i=n[0].user_print;a.user=t.state.user.id,a.printers=i,a.type="qr",fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:v,body:JSON.stringify({query:{print:{type:"print",data:a,sid:l()}}})}).then((function(t){return t.json()})).then((function(e){e.success?b(o("Printing")):D(t,e)})).catch((function(t){h(t)}))}(t,e.currentTarget.dataset.qrnum)})))}},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(w(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var s in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=preview.structOrderItemTable(t,s,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center pt-2"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},structTableCard:function(t,e,a,n){var r=0,s={},o=0,d=__("Table %1$",a);n.orders.forEach((function(t,e){a.includes("#")&&t.id==a.split("#")[1]&&(r=e,s=t,o=t.id,d=__("Take away %1$",t.id)),t.table==a+""&&t.id>o&&(r=e,s=t,o=t.id,d=__("Table %1$",a))})),(s=s||{}).id=s.id?s.id:"",s._id=s._id?s._id:"",s.created=s.created?s.created:"";var c="",l=s._id?s._id:"",u=l;switch(s.status){case"new":c="text-dark bg-warning";break;case"paid":case"processing":c="text-white bg-primary";break;case"completed":default:c="text-white bg-secondary",u="";break;case"failed":case"refunded":c="text-white bg-danger",u=""}return'\n    <div class="col">\n        <div class="card '.concat(c,' mb-2 " style="max-width: 18rem;">\n            <div class="card-header view-order po ').concat(l&&"completed"==s.status?"bg-success":"",'" data-id="').concat(l,'" data-table="').concat(a,'" ').concat(l?'data-index="'+r+'"':"",'">').concat(s.id?i("last order #%1$",s.id):"&nbsp;",'</div>\n            <div class="card-body d-flex align-items-center justify-content-center view-order po" style="min-height:140px;" data-id="').concat(u,'" data-table="').concat(a,'" ').concat(u?'data-index="'+r+'"':"",'">\n                <h5 class="card-title">').concat(i(d),'</h5>\n            </div>\n            <div class="card-footer d-flex justify-content-between">\n                ').concat(s.created?q(__,n.meta.time,s.created):"&nbsp;",'\n                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-qr-code-scan print-qr po ').concat(t.state.settings.qr_print?"":"d-none",' " viewBox="0 0 16 16" data-qrnum="').concat(a,'">\n                    <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"></path>\n                    <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"></path>\n                    <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"></path>\n                    <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"></path>\n                    <path d="M12 9h2V8h-2v1Z"></path>\n                </svg>\n            </div>\n        </div>\n    </div>')}},R={_this:null,state:{orderSingle:null},renderOrder:function(t,e){t.state.changes=!1,t.modal=document.querySelector(".order-modal"),t.modalCont=new bootstrap.Modal(t.modal),t.modalOpen=!0,t.rowMark=-1;var a=e.currentTarget.dataset.index;if(history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search+"#editing"),t.modal.addEventListener("hide.bs.modal",(function(t){-1!=window.location.href.indexOf("#editing")&&history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search)})),void 0===a)if(t.state.orderSingle={_id:"new",created:1649831099,from:"dine-in",id:"",idd:"",items:[],kid:"0",name:"dine-in",note:"",sid:l,status:"new",price:{discount_percent:0},step:1,table:e.currentTarget.dataset.table?e.currentTarget.dataset.table:"-",total:0,updated:1649833845},"new"==t.state.orderSingle._id&&"1"==t.state.settings.add_products){var n=t.state.settings.add_products_list.trim().split("\n");!function(t,e,a){fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:m(),body:JSON.stringify({query:{products:{type:"find",fields:"*",key:"ecommerce-product",id:e,sortby:{field:"created",order:"DESC"}}}})}).then((function(t){return t.json()})).then((function(e){e.success&&(e.products.forEach((function(e,a){t.state.orderSingle.items.push({cats:[],id:e._id,index:a,note:"",price:e.price,qty:1,sdesc:i(e.sdesc),title:i(e.title),total:e.price,type:"new",variations:[]})})),a(t))})).catch((function(t){console.log(t),h(t)}))}(t,n,R.renderOrderUI)}else R.renderOrderUI(t);else t.state.orderSingle=t.state.orders[a],R.renderOrderUI(t);console.log(t.state.orderSingle),f(".print-order",(function(e){e.preventDefault(),t.state.printRequest=e.currentTarget.dataset.id,g(t.modal.querySelector(".btn-confirm"))})),t.listeners.modalSuccessBtnFunc=function(e){e.preventDefault(),t.updateOrder(a,t.state.orderSingle._id)},f(".st-modal li a",(function(e){e.preventDefault(),R._this.state.changes=!0;var a=document.querySelector("#order-status-modal");a.innerHTML=t.state.statuses[e.currentTarget.dataset.key].text,a.dataset.value=e.currentTarget.dataset.key;Object.keys(t.state.statuses).forEach((function(e){t.state.statuses[e].class.split(" ").forEach((function(t){a.classList.remove(t)}))})),t.state.statuses[e.currentTarget.dataset.key].class.split(" ").forEach((function(t){a.classList.add(t)}))}))},renderOrderUI:function(t){var a;R.state.orderSingle=t.state.orderSingle;var n="";Object.keys(t.state.statuses).forEach((function(e,a){n+='<li><a class="dppi dropdown-item" data-key="'.concat(e,'" href="#">').concat(t.state.statuses[e].text,"</a></li>")}));var r='\n        <div class="d-flex justify-content-between">\n            <div class="st-modal st-opts mb-3 me-1 me-sm-3 dropdown">\n                <a class="btn btn-sm '.concat(t.state.statuses[t.state.orderSingle.status].class,' dropdown-toggle order-form" data-id="status" data-type="key" data-value="').concat(t.state.orderSingle.status,'" href="#" role="button" id="order-status-modal" data-bs-toggle="dropdown" aria-expanded="false" >\n                    ').concat(t.state.statuses[t.state.orderSingle.status].text,'\n                </a>\n                <ul class="dropdown-menu" aria-labelledby="order-status-modal">\n                    ').concat(n,'\n                </ul>\n            </div>\n            <a href="#" data-index="0" class="print-order text-success" data-id=').concat(R.state.orderSingle._id,'>\n                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"></path>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"></path>\n                </svg>\n            </a>\n        </div>\n        ');t.modal.querySelector(".modal-dialog").classList.add("modal-fullscreen"),t.modal.querySelector(".modal-header .modal-title").innerHTML=isNaN(t.state.orderSingle.from)?t.state.orderSingle.from:"#"+t.state.orderSingle.from,t.modal.querySelector(".modal-footer .btn-confirm").innerHTML="new"==t.state.orderSingle._id?__("Create"):__("Update"),t.modal.querySelector(".btn-confirm").dataset.loading=!1,t.modal.querySelector(".modal-footer .btn-secondary").innerHTML=__("Close");var s=r,o=(e(a={id:{l:__("ID"),classList:"order-form"},from:{l:__("From"),e:"text",editable:!0,classList:"order-form"},table:{l:__("Table"),e:"text",editable:!0,classList:"order-form"},items:{l:"",e:"items"},fname:{l:__("Name"),e:"text"},lname:{l:__("Surname"),e:"text"},bios:{l:__("Bios"),e:"textarea"},avatar:{l:__("Avatar"),e:"text"},email:{l:__("Email"),e:"text"},countryr:{l:__("Country"),e:"text"},cityr:{l:__("City"),e:"text"},phone:{l:__("Phone"),e:"text"},addr1:{l:__("Address 1"),e:"textarea"},addr2:{l:__("Address 2"),e:"textarea"},post:{l:__("Post"),e:"text"},state:{l:__("State"),e:"text"},c1:{l:__("Whatsapp"),e:"text"},c2:{l:__("Messenger"),e:"text"},c3:{l:__("Line"),e:"text"},c4:{l:__("Email"),e:"text"},c5:{l:__("Telegram"),e:"text"}},"email",{l:__("Email"),e:"text"}),e(a,"bio",{l:__("Bio"),e:"text"}),e(a,"y1",{l:__("Name"),e:"text"}),e(a,"y2",{l:__("IBAN"),e:"text"}),e(a,"y3",{l:__("SWIFT"),e:"text"}),e(a,"y4",{l:__("Bank"),e:"text"}),e(a,"y5",{l:__("Bank city"),e:"text"}),e(a,"y6",{l:__("Bank country"),e:"text"}),e(a,"note",{l:__("Note"),e:"textarea"}),e(a,"s3",{l:__("Link 3"),e:"text"}),e(a,"company",{l:__("Company"),e:"text"}),e(a,"vat",{l:__("Tax ID"),e:"text"}),e(a,"grade",{l:__("Grade"),e:"text"}),e(a,"kenzap_ida",{l:__("Kenzap IDA"),e:"text"}),a);for(var i in o)if(void 0!==t.state.orderSingle[i]){var d=t.state.orderSingle[i],c=o[i].l;s+='\n            <div class="mb-3 mt-3 order-row keyx-'.concat(i," ").concat("_id"==i||"from"==i?"elipsized":"",'"  >\n                <b>').concat(c,"</b>").concat(R.renderField(t,o[i],d,i),"\n            </div>")}setTimeout((function(){R.refreshTotals()}),100),s+="",console.log(t.state.orderSingle.delivery),t.state.orderSingle.delivery&&t.state.orderSingle.delivery.shareLink&&(s+='\n            <div class="mb-3 mt-3 order-row keyx-delivery-map"  >                \n                <iframe src="'.concat(t.state.orderSingle.delivery.shareLink,'" style="width: 100%;min-height: 500px;"></iframe>\n            </div>')),t.modal.querySelector(".modal-body").innerHTML='<div class="modal-body-cont">'+s+"</div>",t.modalCont.show(),R.tableOrderItemListeners(),R.suggestOrderItem(t),t.modal.querySelector(".edit-item").addEventListener("blur",(function(t){setTimeout((function(){document.querySelector(".s-list").dataset.toggle=!1}),500)})),R.addOrderItem(t),"new"==t.state.orderSingle._id&&R.refreshTotals(),"new"==t.state.orderSingle._id&&setTimeout((function(){document.querySelector(".edit-item").focus()}),300)},newOrder:function(t){R._this=t,f(".add-order",(function(e){R.renderOrder(t,e)}))},viewOrder:function(t){R._this=t,f(".view-order",(function(e){R.renderOrder(t,e)}))},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(w(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block p-1" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" style="min-width:50px;">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var s in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=R.structOrderItemTable(t,s,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-cats="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3 mt-2 d-flex">\n                                    <select class="form-select form-select edit-discount me-2 d-none" data-type="select" aria-label="Default payment method">\n                                        <option value="" selected="">%</option>\n                                        <option value="eNets">eNets</option>\n                                        <option value="PayNow">PayNow</option>\n                                    </select>\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center pt-2"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},itemOptions:function(t){return'\n\n        <div class="dropdown text-center">\n            <a  href="#" role="button" id="order-item-options" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical order-item-options" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="order-item-options" >\n                <li><a class="oio dropdown-item edit-item-note" data-key="edit-item-note" href="#">'.concat(__("Add note"),'</a></li>\n                <li><a class="oio dropdown-item d-none" data-key="edit-item-variation" href="#">').concat(__("Add variation"),'</a></li>\n                <li><a class="oio dropdown-ite d-none" data-key="edit-item-price" href="#">').concat(__("Adjust price"),'</a></li>\n                <li><a class="oio dropdown-item text-danger remove-item" data-key="remove-item" href="#">').concat(__("Remove"),"</a></li>\n            </ul>\n        </div>\n    ")},structOrderItemTable:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.created!=a[e].created&&(t.rowMark+=1),t.created=a[e].created,a[e].cats=a[e].cats?a[e].cats:[];var s="",o="";for(var d in a[e].variations){var c="";for(var l in a[e].variations[d].list)c+=i(a[e].variations[d].list[l].title)+" ";s+='<div><b class="me-1">'+i(a[e].variations[d].title)+"</b> <span>"+c+"</span></div> ",void 0!==a[e].variations[d].note&&a[e].variations[d].note.length>0&&(s+="<div><b>"+__("Note")+"</b> "+a[e].variations[d].note+"</div> ")}var u="";return a[e].discount_percent&&(u=" (-"+a[e].discount_percent+"%)"),a[e].discount_value&&(u=" (-"+w(t,a[e].discount_value)+")"),a[e].discounts||(a[e].discounts=[]),a[e].discounts.forEach((function(t){"never"==t.type&&(a[e].discount_type="never")})),o+='<tr class="order-item-row-active row-mark'+t.rowMark+'" data-created="'+a[e].created+'" data-x="'+e+'" data-id="'+a[e].id+'" data-vars="'+k(JSON.stringify(a[e].variations))+'" data-cats="'+k(JSON.stringify(a[e].cats))+'" data-discounts="'+k(JSON.stringify(a[e].discounts))+'">',o+='<td><div class="item-title" contenteditable="false" data-value="'+a[e].title+'" data-sdesc="'+(a[e].sdesc?a[e].sdesc:"")+'">'+i(a[e].title)+'</div><div class="item-note text-muted mb-1 '+(0!=a[e].note.length&&"<br>"!=a[e].note||n?"":"d-none")+'" contenteditable="true" data-value="'+a[e].note+'">'+a[e].note+'</div><div class="vars border-primary item-variations my-1 ps-2 text-secondary" data-value="">'+s+'</div></td><td class="qty"><div class="me-1 me-sm-3 item-qty" data-value="'+a[e].qty+'">'+a[e].qty+'</div></td><td class="tp"><div class="me-1 me-sm-3 item-total" data-price="'+a[e].price+'" data-value="'+a[e].total+'" data-discount_type="'+(a[e].discount_type?a[e].discount_type:"")+'" data-discount_percent="'+(a[e].discount_percent?a[e].discount_percent:"")+'" data-discount_value="'+(a[e].discount_value?a[e].discount_value:"")+'">'+w(t,a[e].total)+u+'</div><td class="'+(r?"":"d-none")+'">'+R.itemOptions(a[e])+"</td></td>",o+="</tr>"},suggestOrderItem:function(e){y(".edit-item",(function(a){var n=a.keyCode||a.charCode;if(!(n>=34&&n<=45)){var r,s,o=a.currentTarget.value;if(1==o.length&&document.querySelector(".modal-body").scrollTo({top:document.querySelector(".edit-item").getBoundingClientRect().top-document.querySelector(".modal-body-cont").getBoundingClientRect().top-20,behavior:"smooth"}),0!=o.length&&a.currentTarget===document.activeElement)fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:v,body:JSON.stringify({query:{products:{type:"find",key:"ecommerce-product",fields:["_id","id","img","status","cats","variations","price","discounts","title"],limit:e.state.slist,term:[{type:"string",field:"status",relation:"=",value:"1"}],offset:o.length>0?0:(r=new URLSearchParams(window.location.search),s=r.get("page")?r.get("page"):1,parseInt(s)*e.state.slist-e.state.slist),search:{field:"title",s:o},sortby:{field:"title",order:"DESC"}}}})}).then((function(t){return t.json()})).then((function(a){if(d(),a.success){e.state.productsSuggestions=a.products;var n="";a.products.forEach((function(t,e){n+='<li class="s-list-item py-1" data-id="'.concat(t._id,'" data-title="').concat(t.title,'" data-index="').concat(e,'"  data-display="true" data-highlight="false">').concat(t.title,"</li>")})),document.querySelector(".s-list").innerHTML=n,document.querySelector(".s-list").dataset.toggle=!0,f(".s-list-item",(function(a){var n=a.currentTarget.dataset.index;if(console.log(e.state.productsSuggestions[n]),document.querySelector(".edit-item").dataset.index=n,document.querySelector(".edit-item").dataset.id=e.state.productsSuggestions[n]._id,document.querySelector(".edit-item").dataset.cats=JSON.stringify(e.state.productsSuggestions[n].cats),document.querySelector(".edit-item").value=e.state.productsSuggestions[n].title,document.querySelector(".edit-item").dataset.discounts=JSON.stringify(e.state.productsSuggestions[n].discounts),document.querySelector(".edit-qty").value=1,document.querySelector(".edit-qty").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").value=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".s-list").dataset.toggle=!1,document.querySelector(".edit-discount").classList.add("d-none"),e.state.productsSuggestions[n].discounts&&e.state.productsSuggestions[n].discounts.length>0){var r='<option value="">%</option>';e.state.productsSuggestions[n].discounts.forEach((function(t){"admin"==t.availability&&"percent"==t.type&&(r+='<option data-type="percent" value="'+t.percent+'">-'+t.percent+"%</option>",document.querySelector(".edit-discount").classList.remove("d-none")),"admin"==t.availability&&"value"==t.type&&(r+='<option data-type="value" value="'+t.value+'">-'+w(R._this,t.value)+"</option>",document.querySelector(".edit-discount").classList.remove("d-none")),t.type})),document.querySelector(".edit-discount").innerHTML=r,((t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("change",e,!0),a.addEventListener("change",e,!0)})(".edit-discount",(function(t){setTimeout((function(){s()}),300)}))}var s=function(){var t=document.querySelector(".edit-discount").options[document.querySelector(".edit-discount").selectedIndex].dataset.type,e=parseFloat(document.querySelector(".edit-qty").value)*parseFloat(document.querySelector(".edit-qty").dataset.price);isNaN(e)?e="":("percent"==t&&(e-=e*parseInt(document.querySelector(".edit-discount").value)/100),"value"==t&&(e-=parseFloat(document.querySelector(".edit-discount").value))),document.querySelector(".edit-tp").value=e};document.querySelector(".edit-qty").addEventListener("keypress",(function(t){if(8!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").addEventListener("keydown",(function(t){setTimeout((function(){s()}),300)})),document.querySelector(".edit-tp").addEventListener("keypress",(function(t){if(8!=t.which&&46!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").focus(),document.querySelector(".edit-qty").select(),document.querySelector(".item-vars-input").innerHTML=function(e,a){var n="";if(t("undefined"!==a.variations))for(var r in a.variations){var s="";for(var o in"checkbox"==a.variations[r].type&&(s="check"),"radio"==a.variations[r].type&&(s="radio"),n+="        <b>"+i(a.variations[r].title)+("1"==a.variations[r].required?' <span class="tag">'+i("required")+"</span>":"")+'</b>        <div class="kp-'+s+'" >',a.variations[r].data)switch(a.variations[r].data[o].price=S(a.variations[r].data[o].price),s){case"check":n+='                    <label>                        <input type="checkbox" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" data-index="'+o+'" data-title="'+a.variations[r].data[o].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[o].price+'" >                        <div class="checkbox">                            <svg width="20px" height="20px" viewBox="0 0 20 20">                                <path d="M3,1 L17,1 L17,1 C18.1045695,1 19,1.8954305 19,3 L19,17 L19,17 C19,18.1045695 18.1045695,19 17,19 L3,19 L3,19 C1.8954305,19 1,18.1045695 1,17 L1,3 L1,3 C1,1.8954305 1.8954305,1 3,1 Z"></path>                                <polyline points="4 11 8 15 16 6"></polyline>                            </svg>                        </div>                        <span>'+i(a.variations[r].data[o].title)+'</span>                        <div class="price">+ '+w(e,a.variations[r].data[o].price)+"</div>                    </label>";break;case"radio":n+='                    <label>                        <input type="radio" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" name="radio'+r+'" data-index="'+o+'" data-title="'+a.variations[r].data[o].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[o].price+'"  />                        <span>'+i(a.variations[r].data[o].title)+'</span>                        <div class="price">+ '+w(e,a.variations[r].data[o].price)+"</div>                    </label>"}n+="</div>"}return n}(e,e.state.productsSuggestions[n])}))}else h(a)})).catch((function(t){console.log(t),h(t)}));else document.querySelector(".s-list").dataset.toggle=!1}}))},tableOrderItemListeners:function(t){f(".edit-item-note",(function(t){t.preventDefault();var e=t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector(".item-note");e.classList.remove("d-none"),e.focus(),R._this.state.changes=!0})),f(".remove-item",(function(t){t.preventDefault(),t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.remove(),R.refreshTotals(),R._this.state.changes=!0}))},refreshTotals:function(){var t,e="",a=0,n=s(document.querySelectorAll(".item-total"));try{for(n.s();!(t=n.n()).done;){var r=t.value;a+=S(r.dataset.value)}}catch(t){n.e(t)}finally{n.f()}var o={grand_total:0,total:S(a),discount_percent:document.querySelector(".discount-percent-inp")?parseInt(document.querySelector(".discount-percent-inp").value):R.state.orderSingle.price.discount_percent?R.state.orderSingle.price.discount_percent:0,discount_value:document.querySelector(".discount-value-inp")?parseFloat(document.querySelector(".discount-value-inp").value):R.state.orderSingle.price.discount_value?R.state.orderSingle.price.discount_value:0,discount_total:0,fee_total:0,tax_total:0,tax_percent:0},d='<div class="mb-2 mt-2 order-total-subtotal order-row text-right elipsized keyx-total">\n                <b>'.concat(i("Subtotal"),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(w(R._this,o.total),"</div>\n             </div>");if(e+=d,"1"==R._this.state.settings.custom_payment_method){var c="";R._this.state.settings.payment_methods.trim().split("\n").forEach((function(t,e){c+='<option value="'.concat(t,'" ').concat(R.state.orderSingle.price.payment_method==t?"selected":""," >").concat(t,"</option>")})),e+='<div class="mb-2 mt-2 order-total-payment_method order-row text-right keyx-payment_method">\n                    <b>'.concat(__("Payment"),'</b>\n                    <div class="ms-2 d-inline-block" >\n                        <select class="form-select form-select-sm payment-method-select" data-type="select" aria-label="Default payment method">\n                            ').concat(c,"\n                        </select>\n                    </div>\n                </div>")}if(document.querySelector(".order-total-subtotal")&&(document.querySelector(".order-total-subtotal").outerHTML=d),e+='<div class="mb-2 mt-2 order-total-discount d-flex align-items-center justify-content-end bd-highlight order-row keyx-total">\n                <div class="dropdown">\n                    <button class="btn border-0 dropdown-toggle fw-bold" type="button" id="discount-type" data-bs-toggle="dropdown" aria-expanded="false">\n                    '.concat(parseFloat(o.discount_value)>0?__("Discount by value"):__("Discount by %"),'\n                    </button>\n                    <ul class="dropdown-menu discount-type-option" aria-labelledby="discount-type">\n                        <li><a class="dropdown-item" data-type="percent" href="#">').concat(__("Discount by %"),'</a></li>\n                        <li><a class="dropdown-item" data-type="value" href="#">').concat(__("Discount by value"),'</a></li>\n                    </ul>\n                </div>\n                <div class="ms-2 d-inline-block" data-type="key-number" >\n                    <input type="text" autocomplete="off" maxlength="3" class="discount-percent-inp form-control form-control-sm text-end ').concat(parseFloat(o.discount_value)>0?"d-none":"",'" value="').concat(o.discount_percent,'" style="max-width:50px;">\n                    <input type="text" autocomplete="off" class="discount-value-inp ').concat(parseFloat(o.discount_value)>0?"":"d-none",' form-control form-control-sm text-end" value="').concat(o.discount_value,'" style="max-width:120px;">\n                </div>\n            </div>'),parseInt(o.discount_percent)>0){o.discount_total=0;var l,u=s(document.querySelectorAll(".item-total"));try{for(u.s();!(l=u.n()).done;){var p=l.value;"never"!=p.dataset.discount_type&&(o.discount_total+=S(parseInt(o.discount_percent)*S(p.dataset.value))/100)}}catch(t){u.e(t)}finally{u.f()}a-=o.discount_total}if(parseFloat(o.discount_value)>0&&parseFloat(o.discount_value)>0&&(a-=o.discount_value),"1"==R._this.state.settings.fee_calc){o.fee_total=S(R._this.state.settings.fee_percent*a)/100,o.fee_percent=S(R._this.state.settings.fee_percent);var m='<div class="mb-2 mt-2 order-total-fee order-row text-right elipsized">\n                    <b>'.concat(__(R._this.state.settings.fee_display),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(w(R._this,o.fee_total),"</div>\n                 </div>");e+=m,document.querySelector(".order-total-fee")&&(document.querySelector(".order-total-fee").outerHTML=m),a+=o.fee_total}if("1"==R._this.state.settings.tax_calc){o.tax_total=S(a*parseFloat(R._this.state.settings.tax_percent)/100),o.tax_percent=S(R._this.state.settings.tax_percent);var v='<div class="mb-2 mt-2 order-total-tax order-row text-right elipsized">\n                    <b>'.concat(R._this.state.settings.tax_display,'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(w(R._this,o.tax_total),"</div>\n                 </div>");e+=v,document.querySelector(".order-total-tax")&&(document.querySelector(".order-total-tax").outerHTML=v),a+=o.tax_total}o.grand_total=S(a);var h='<div class="mb-2 mt-2 order-total-grandtotal order-row text-right elipsized">\n                <b>'.concat(i("Grand Total"),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(w(R._this,o.grand_total),"</div>\n             </div>");e+=h,document.querySelector(".order-total-grandtotal")&&(document.querySelector(".order-total-grandtotal").outerHTML=h),document.querySelector(".order-total")?document.querySelector(".order-total").dataset.price=encodeURIComponent(JSON.stringify(o)):(document.querySelector(".modal-body-cont").insertAdjacentHTML("beforeend",'<div class="mt-5 order-total order-form text-end" data-type="price" data-price="'.concat(encodeURIComponent(JSON.stringify(o)),'">').concat(e,"</div>")),f(".discount-type-option li a",(function(t){switch(t.preventDefault(),document.querySelector("#discount-type").dataset.type=t.currentTarget.dataset.type,console.log(t.currentTarget.dataset.type),t.currentTarget.dataset.type){case"value":document.querySelector("#discount-type").innerHTML=i("Discount by value"),document.querySelector(".discount-value-inp").style.maxWidth="120px",document.querySelector(".discount-value-inp").classList.remove("d-none"),document.querySelector(".discount-percent-inp").classList.add("d-none"),document.querySelector(".discount-percent-inp").value=0;break;case"percent":document.querySelector("#discount-type").innerHTML=i("Discount by %"),document.querySelector(".discount-percent-inp").style.maxWidth="70px",document.querySelector(".discount-value-inp").classList.add("d-none"),document.querySelector(".discount-percent-inp").classList.remove("d-none"),document.querySelector(".discount-value-inp").value=0}R._this.state.changes=!0,R.refreshTotals()})),x(".discount-percent-inp",[8]),y(".discount-percent-inp",(function(t){parseInt(t.currentTarget.value)>100||parseInt(t.currentTarget.value)<0?t.currentTarget.setCustomValidity("wrong percent value"):t.currentTarget.setCustomValidity(""),t.currentTarget.parentElement.classList.add("was-validated"),t.currentTarget.style.maxWidth="70px",R.refreshTotals()})),x(".discount-value-inp",[8,46]),y(".discount-value-inp",(function(t){parseInt(t.currentTarget.value)<0||parseInt(t.currentTarget.value)>o.total?t.currentTarget.setCustomValidity("wrong discount value"):t.currentTarget.setCustomValidity(""),t.currentTarget.parentElement.classList.add("was-validated"),t.currentTarget.style.maxWidth="120px",R._this.state.changes=!0,R.refreshTotals()})))},addOrderItem:function(t){f(".add-item",(function(e){var a=[],n={};n.id=document.querySelector(".edit-item").dataset.id,n.cats=JSON.parse(document.querySelector(".edit-item").dataset.cats),n.title=document.querySelector(".edit-item").value,n.total=parseFloat(document.querySelector(".edit-tp").value),n.price=parseInt(document.querySelector(".edit-tp").dataset.price),n.discounts=JSON.parse(document.querySelector(".edit-item").dataset.discounts),n.qty=parseInt(document.querySelector(".edit-qty").value),n.note="",n.created=R.state.orderSingle.updated,n.variations=[];var r=document.querySelector(".edit-discount").options[document.querySelector(".edit-discount").selectedIndex].dataset.type;"percent"==r&&(n.discount_percent=document.querySelector(".edit-discount").value),"value"==r&&(n.discount_value=document.querySelector(".edit-discount").value);var o,i=0,d=s(document.querySelectorAll(".item-vars-input input"));try{for(d.s();!(o=d.n()).done;){var c=o.value,l=i;c.checked&&(n.variations[l]||(n.variations[l]={}),n.variations[l].list||(n.variations[l].list={}),n.variations[l].title||(n.variations[l].title=c.dataset.titlev),n.variations[l].list["_"+c.dataset.index]={title:c.dataset.title,price:parseFloat(c.dataset.price)},n.total+=n.qty*parseFloat(c.dataset.price),i+=1)}}catch(t){d.e(t)}finally{d.f()}if(n.title.length<2)alert(__("Incorrect product data"));else{a.push(n);var u=R.structOrderItemTable(t,0,a,!0);document.querySelector(".new-item-row").insertAdjacentHTML("beforebegin",u),R.tableOrderItemListeners(),R.refreshTotals(),document.querySelector(".edit-item").value="",document.querySelector(".edit-tp").value="",document.querySelector(".edit-qty").value="",document.querySelector(".edit-discount").value="",document.querySelector(".item-vars-input").innerHTML="",setTimeout((function(){document.querySelector(".edit-item").focus()}),300),R._this.state.changes=!0}}))}},V={state:{firstLoad:!0,changes:!1,modalCont:null,modalOpen:!1,playSound:{allowed:!1,ids:null,nids:[],n:0,max_times:5,timer:null,audio:new Audio("https://kenzap.com/static/swiftly.mp3")},orderIDs:[],printLink:null,printRequest:null,user:{},orders:[],settings:{},qr_settings:{},orderSingle:[],printQueue:[],updates:{last_order_id:"",last_order_update:0},playTitleTimer:null,refreshTimer:null,statuses:[],limit:200,slistLimit:10,productsSuggestions:[]},init:function(){V.getData();var t=function(t){V.state.firstLoad&&(V.state.updates.last_order_id=t.last_order_id,V.state.updates.last_order_update=t.last_order_update),t.last_order_update!=V.state.updates.last_order_update&&(T(V,1),V.getData(),V.state.updates.last_order_id=t.last_order_id,V.state.updates.last_order_update=t.last_order_update)};V.state.refreshTimer=setInterval((function(){!function(t,e,a){fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:m(),body:JSON.stringify({query:{updates:{type:"updates",source:e}}})}).then((function(t){return t.json()})).then((function(e){e.success&&(a(e),M(t,e.messages))})).catch((function(t){}))}(V,["messages","last_order_id"],t)}),5e3)},getData:function(){V.state.firstLoad&&(()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")})(),V.state.printRequest&&V.state.printQueue.push({_id:V.state.printRequest,type:"user",template:null});var t=document.querySelector(".search-input")?document.querySelector(".search-input").value:"",e=document.querySelector("#order-status")?document.querySelector("#order-status").dataset.value:"";document.querySelector("body.modal-open")||fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:m(),body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar","id"],token:u("kenzap_token")},locale:{type:"locale",source:["extension"],key:"ecommerce"},orders:{type:"find",key:"ecommerce-order",fields:"*",term:""!=e?"status='"+e+"'":"",limit:V.state.limit,search:{field:"from",s:t},sortby:{field:"created",order:"DESC"}},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_percent_auto","tax_percent","tax_display","fee_calc","fee_percent","fee_display","payment_methods","custom_payment_method","tables","table_list","add_products","add_products_list","templates"]}}})}).then((function(t){return t.json()})).then((function(t){d(),t.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),t.cdn&&localStorage.setItem("cdn",t.cdn),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(t),V.loadPageStructure(),V.renderPage(t),V.initListeners(),C(),V.state.firstLoad=!1):h(t)})).catch((function(t){h(t)}))},authUser:function(t){t.user&&t.user.success},loadPageStructure:function(){V.state.firstLoad&&(document.querySelector("#contents").innerHTML='\n      <div class="container ec-orders">\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n            <nav class="bc" aria-label="breadcrumb"></nav>\n            <button class="btn btn-primary add-order btn-add mt-3 mb-1 mt-md-0 mb-md-0" type="button">'.concat(i("New order"),'</button>\n        </div>\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n          <div>\n            <div class="col-md-12 page-title">\n              <div class="st-opts st-table dropdown">\n                  <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="order-status" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                    ').concat(i("All"),'\n                  </a>\n                  <ul class="dropdown-menu" aria-labelledby="order-status">\n                    <li><a class="dppi dropdown-item" data-key="" href="#" >').concat(i("All"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="new" href="#" >').concat(i("New"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="paid" href="#" >').concat(i("Paid"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="processing" href="#" >').concat(i("Processing"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="completed" href="#" >').concat(i("Completed"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="canceled" href="#" >').concat(i("Canceled"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="failed" href="#" >').concat(i("Failed"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="refunded" href="#" >').concat(i("Refunded"),'</a></li>\n                  </ul>\n              </div>\n              <div class="st-opts" >\n                <div class="input-group-sm mb-0 justify-content-start mb-sm-0" >\n                  <input id="usearch" type="text" class="inp form-control search-input" autocomplete="off" placeholder="').concat(i("Search order"),'">\n                </div>\n                \x3c!-- <a id="viewSum" href="#" style="margin-left:16px;">view summary</a> --\x3e\n              </div>\n            </div>\n          </div>\n          <div class="qr-print-cnt d-none align-self-center my-3 my-md-0">\n            <div class="d-inline-block">\n              <input id="qr-number" type="text" class="inp form-control form-control-sm qr-number p-0 px-2 me-2 ms-0" autocomplete="off" style="max-width:100px;" placeholder="').concat(__("QR number"),'">\n            </div>\n            <div class="d-inline-block">\n              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-qr-code-scan print-qr po" viewBox="0 0 16 16">\n                <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"/>\n                <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"/>\n                <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"/>\n                <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"/>\n                <path d="M12 9h2V8h-2v1Z"/>\n              </svg>\n            </div>\n          </div> \n        </div>\n\n        <div id="orders-after-header">\n\n\n        </div>\n\n        <div class="row">\n          <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n            <div class="card border-white shadow-sm border-0">\n              <div class="card-body p-0">\n \n                <div class="table-responsive">\n                  <table class="table table-hover table-borderless align-middle table-striped table-p-list mb-0">\n                    <thead>\n                      <tr>\n                        <th><span class="ps-1">').concat(i("From"),'</span></th>\n                        <th class="d-none d-sm-table-cell">').concat(i("Status"),"</th>\n                        <th>").concat(i("Subtotal"),'</th>\n                        <th class="d-none d-sm-table-cell">').concat(i("Time"),'</th>\n                        <th></th>\n                      </tr>\n                    </thead>\n                    <tbody class="list">\n\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="modal order-modal" tabindex="-1" data-backdrop="static" data-keyboard="false">\n        <div class="modal-dialog ">\n          <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title"></h5>\n                <button type="button" class="btn-close align-self-start-remove" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body">\n              \n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-primary btn-confirm"></button>\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n              </div>\n          </div>\n        </div>\n      </div>\n\n    '))},renderPage:function(t){if(V.state.firstLoad&&((t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let a of t)void 0===a.link?e+=`<li class="breadcrumb-item">${a.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:c("https://dashboard.kenzap.cloud"),text:i("Home")},{link:c("/"),text:i("E-commerce")},{text:i("Orders")}]),V.state.statuses={new:{text:i("New"),class:"btn-warning text-dark fw-light"},paid:{text:i("Paid"),class:"btn-primary fw-light"},processing:{text:i("Processing"),class:"btn-primary fw-light"},completed:{text:i("Completed"),class:"btn-success fw-light"},canceled:{text:i("Canceled"),class:"btn-secondary fw-light"},failed:{text:i("Failed"),class:"btn-danger fw-light"},refunded:{text:i("Refunded"),class:"btn-danger fw-light"}}),V.state.user=t.user,V.state.orders=t.orders,V.state.meta=t.meta,V.state.settings=t.settings,V.state.settings.templates||(V.state.settings.templates=[]),V.state.settings.qr_print=function(t){return t.state.settings.templates.filter((function(e){return"qr"==e.type&&(""==e.user||e.user==t.state.user.id)})).length>0}(V),V.state.settings.qr_print&&document.querySelector(".qr-print-cnt").classList.remove("d-none"),0!=t.orders.length){var e=[];V.state.newOrderCount=[];var a="",n="";for(var r in t.orders){e.push(t.orders[r]._id),void 0===t.orders[r].status&&(t.orders[r].status="new"),"new"==t.orders[r].status&&(n+=t.orders[r].id);var s=V.state.orderIDs.includes(t.orders[r]._id)||V.state.firstLoad?"":"new";a+='\n            <tr class="'.concat(s,'">\n              <td class="details view-order" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'">\n                <div class="ps-1" >\n                  <b class="">').concat(t.orders[r].id,"</b> ").concat(t.orders[r].from,'\n                  <div class=" elipsized fst-italic">').concat(t.orders[r].note?t.orders[r].note:"",'</div>\n                  <div class=" d-sm-none"> <span class="me-2">').concat(V.getStatus(t.orders[r].status),'</span> <span class="text-muted">').concat(q(__,t.meta.time,t.orders[r].created),'</span> </div>\n                </div>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span class="fs-12">').concat(V.getStatus(t.orders[r].status),'</span>\n              </td>\n              <td>\n                <span style="font-size:18px;">').concat(w(V,t.orders[r].total),'</span>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span style="font-size:18px;">').concat(q(__,t.meta.time,t.orders[r].created),'</span>\n              </td>\n              <td class="last">\n                <a href="#" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="view-order text-success d-none me-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>\n                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>\n                </svg></a>\n                <a href="kenzapprint://kenzapprint.app?data=').concat(encodeURIComponent(JSON.stringify({print:'[C]<u><font size="big">ORDER{{order_id_short}}</font></u>\n[C]Fu Zhen Seafood\n[C]<u type=double>{{date_time}}</u>\n[C]\n[C]================================" \n[L]\n[L]<b>BEAUTIFUL SHIRT</b>[R]9.99€\n[L]  + Size : S\n[L]\n[L]<b>AWESOME HAT</b>[R]24.99€\n[L]  + Size : 57/58\n[L]\n[C]--------------------------------\n[R]TOTAL PRICE :[R]34.98€\n[R]TAX :[R]4.23€'})),'" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="print-order-dis d-none text-success me-2">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>\n                </svg></a>\n                <a href="#" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="remove-order text-danger me-2"><svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n                </svg></a>\n              </td>\n            </tr>')}V.state.playSound.ids&&V.state.playSound.ids!=n&&V.state.playSound.ids.length<n.length&&T(V,3),V.state.playSound.ids=n,V.state.orderIDs=e,document.querySelector(".table tbody").innerHTML=a}else document.querySelector(".table tbody").innerHTML='<tr><td colspan="5">'.concat(i("No orders to display."),"</td></tr>")},getStatus:function(t){return'<div class="badge '.concat(V.state.statuses[t].class,'">').concat(V.state.statuses[t].text,"</div>")},initListeners:function(){N.render(V),R.viewOrder(V),f(".remove-order",V.listeners.removeOrder),f(".st-table li a",V.listeners.changeStatus),V.state.firstLoad&&(A(V),R.newOrder(V),f(".modal .btn-primary",V.listeners.modalSuccessBtn),y(".search-input",V.listeners.searchOrders),document.body.addEventListener("touchstart",(function(){V.state.playSound.allowed=!0}),!1),document.body.addEventListener("mousedown",(function(){V.state.playSound.allowed=!0}),!1),window.addEventListener("hashchange",(function(t){if(V.modalCont)return t.preventDefault(),V.modalOpen=!1,V.modalCont.hide(),!1})))},listeners:{newOrder:function(t){},changeStatus:function(t){t.preventDefault();var e=document.querySelector("#order-status");""==t.currentTarget.dataset.key?(e.innerHTML=i("All"),e.dataset.value=""):(e.innerHTML=V.state.statuses[t.currentTarget.dataset.key].text,e.dataset.value=t.currentTarget.dataset.key);Object.keys(V.state.statuses).forEach((function(t){V.state.statuses[t].class.split(" ").forEach((function(t){e.classList.remove(t)})),e.classList.remove("btn-outline-secondary")})),""==t.currentTarget.dataset.key?e.classList.add("btn-outline-secondary"):V.state.statuses[t.currentTarget.dataset.key].class.split(" ").forEach((function(t){e.classList.add(t)})),V.getData()},removeOrder:function(t){t.preventDefault(),confirm(__("Completely remove this order?"))&&fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:m(),body:JSON.stringify({query:{product:{type:"delete-order",id:t.currentTarget.dataset.id,sid:l()}}})}).then((function(t){return t.json()})).then((function(t){t.success?V.getData():h(t)})).catch((function(t){h(t)}))},searchOrders:function(t){t.preventDefault(),V.getData()},modalSuccessBtn:function(t){V.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},updateOrder:function(t,e){if(!V.state.changes&&V.state.printRequest)return V.state.printQueue.push({_id:V.state.printRequest,type:"user",template:null}),void V.modalCont.hide();var a=document.querySelector(".modal");if("true"!==a.querySelector(".btn-confirm").dataset.loading){a.querySelector(".btn-confirm").dataset.loading=!0,a.querySelector(".btn-confirm").innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+i("Loading..");var n,r={},o=s(document.querySelectorAll(".order-form"));try{for(o.s();!(n=o.n()).done;){var d=n.value;switch(d.dataset.type){case"key":r[d.dataset.id]=d.dataset.value;break;case"key-number":r[d.dataset.id]=S(d.dataset.value);break;case"items":r.items=[];var c,u=s(document.querySelectorAll(".order-item-row-active"));try{for(u.s();!(c=u.n()).done;){var p=c.value,v=JSON.parse(L(p.dataset.vars)),f=JSON.parse(L(p.dataset.cats)),y=JSON.parse(L(p.dataset.discounts)),g={id:p.dataset.id,qty:parseInt(p.querySelector(".item-qty").dataset.value),cats:f||[],discounts:y||[],note:p.querySelector(".item-note").innerHTML,type:"new",index:"0",price:parseFloat(p.querySelector(".item-total").dataset.price),sdesc:p.querySelector(".item-title").dataset.sdesc,title:p.querySelector(".item-title").dataset.value,total:parseFloat(p.querySelector(".item-total").dataset.value),variations:"new"==e?[]:v||[]};p.querySelector(".item-total").dataset.discount_percent&&(g.discount_percent=p.querySelector(".item-total").dataset.discount_percent),p.querySelector(".item-total").dataset.discount_value&&(g.discount_value=p.querySelector(".edit-total").dataset.discount_value),r.items.push(g)}}catch(t){u.e(t)}finally{u.f()}break;case"text":r[d.dataset.id]=d.innerHTML;break;case"email":case"emails":case"select":case"textarea":r[d.id]=d.value;break;case"radio":r[d.id]=d.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector("input:checked").value;break;case"price":r.price=JSON.parse(decodeURIComponent(d.dataset.price)),r.total=r.price.total,r.total_all=r.price.grand_total,document.querySelector(".payment-method-select")&&(r.price.payment_method=document.querySelector(".payment-method-select").value)}}}catch(t){o.e(t)}finally{o.f()}var w=new Date;r.created_ymd=w.getUTCFullYear()+""+_(w.getUTCMonth()+1)+_(w.getUTCDate()),r.created_ym=w.getUTCFullYear()+""+_(w.getUTCMonth()+1),r.created_y=w.getUTCFullYear()+"",r.printed=!!V.state.printRequest,r.notify=!1,R._this.state.changes=!1,"new"==e?(r.name=r.from,r.customer={first_name:r.from,last_name:"",kid:0},fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:m(),body:JSON.stringify({query:{order:{type:"create-order",key:"ecommerce-order",data:r}}})}).then((function(t){return t.json()})).then((function(t){t.success?(V.modalCont.hide(),b(__("Order created")),"new"==V.state.printRequest&&(V.state.printRequest=r._id),V.getData()):h(t)})).catch((function(t){h(t)}))):fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:m(),body:JSON.stringify({query:{order:{type:"update-order",id:e,sid:l(),data:r}}})}).then((function(t){return t.json()})).then((function(t){t.success?(V.modalCont.hide(),b(__("Order updated")),V.getData()):h(t)})).catch((function(t){h(t)}))}},initFooter:function(){C(__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"))}};V.init()}();
